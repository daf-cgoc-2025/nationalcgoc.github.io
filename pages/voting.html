<!DOCTYPE html>
<!--[if IE 8 ]><html class="no-js oldie ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]><html class="no-js oldie ie9" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9MLXG6SFE1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-9MLXG6SFE1');
  </script>
  
  <meta charset="utf-8">
  <title>Vote for Your Favorite Photo - DAFCGOC</title>
  <meta name="description" content="Vote for your favorite photo to feature on the front page of DAFCGOC.">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- CSS -->
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/vendor.min.css">
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/v4-shims.css">
  
  <!-- Modernizr -->
  <script src="../js/modernizr.js"></script>
  <link rel="shortcut icon" href="../favicon.png">
  
  <style>
    /* Outer grid container */
    #photo-grid {
      max-width: 900px;            /* restrict total width so we get at most 3 columns at large sizes */
      margin: 0 auto;             /* center the entire grid container */
      padding: 20px 0;
      display: grid;
      /* 
         "auto-fit" or "auto-fill" can be used. 
         With 280px min, you'll get up to 3 columns (because 3Ã—280=840 + gap fits under 900). 
      */
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      justify-content: center;     /* center columns if there's extra space */
    }

    /* Each grid item */
    .bgrid.folio-item {
      display: flex;
      flex-direction: column;
      align-items: center;         /* center content within each item */
      max-width: 320px;           /* optional cap so items don't stretch too large */
      width: 100%;
    }

    /* Enforce a consistent aspect ratio for each image box */
    .item-wrap {
      width: 100%;
      aspect-ratio: 3 / 4;        /* adjust as desired (e.g., 4/3, 1/1, etc.) */
      background-color: #222;      /* letterbox/pad color if image ratio doesn't match */
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Display entire image, letterboxed if needed */
    .item-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain; 
    }

    /* Container for vote button & count */
    .vote-container {
      text-align: center;
    }
    .vote-button {
      background: #007bff;
      border: none;
      border-radius: 4px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 5px;
      color: #fff;
    }
    .vote-button:hover {
      background: #0056b3;
    }
    .vote-count {
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header id="main-header">
    <div class="row">
      <div class="logo">
        <a href="../index.html">Home - DAFCGOC</a>
      </div>
      <nav id="nav-wrap">
        <a class="mobile-btn" href="#nav-wrap" title="Show navigation"><span class="menu-icon">Menu</span></a>
        <a class="mobile-btn" href="#" title="Hide navigation"><span class="menu-icon">Menu</span></a>
        <ul id="nav" class="nav">
          <li><a href="../index.html">Home</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="leadership.html">Leadership</a></li>
          <li><a href="councils.html">Councils</a></li>
          <li><a href="award-winners.html">Award Winners</a></li>
          <li><a href="resources.html">Resources</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Content: Voting Section -->
  <section id="portfolio">
    <div class="row section-head">
      <div class="twelve columns">
        <h1>Vote for Your Favorite Photo</h1>
        <hr />
        <p>Select the photo you want on our front page. Your vote is stored persistently via Cloud Firestore and updates in real time.</p>
      </div>
    </div>
    
    <!-- Photo grid container -->
    <div class="row items" id="photo-grid">
      <!-- Voting items are generated dynamically via JavaScript -->
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="row">
      <div class="twelve columns content group">
        <ul class="social-links">
          <li><a href="https://www.facebook.com/DAFCGOC" target="_blank"><i class="fab fa-facebook-square"></i></a></li>
          <li><a href="https://www.instagram.com/dafcgoc/" target="_blank"><i class="fab fa-instagram-square"></i></a></li>
          <li><a href="https://www.youtube.com/@dafcgoc" target="_blank"><i class="fab fa-youtube-square"></i></a></li>
          <li><a href="https://www.linkedin.com/company/dafcgoc" target="_blank"><i class="fab fa-linkedin-square"></i></a></li>
          <li><a href="mailto:contact@afcgoc.org"><i class="fa fa-envelope-square"></i></a></li>
        </ul>
        <hr />
        <ul class="copyright">
          <li>&copy; 2023 The Dept. of the Air Force Company Grade Officers' Council</li>
          <li class="disclaimer">
            The views expressed on this website and its associated media are those of the collective and individual volunteers and do not reflect the official policy or position of the United States Air Force, United States Space Force, Department of Defense, or government.
          </li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- JS Files (from your theme) -->
  <script src="../js/jquery-1.11.3.min.js"></script>
  <script src="../js/jquery-migrate-1.2.1.min.js"></script>
  <script src="../js/jquery.fittext.js"></script>
  <script src="../js/jquery.magnific-popup.min.js"></script>
  <script src="../js/main.js"></script>

  <!-- Firebase Voting Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
    import { 
      getFirestore, 
      doc, 
      getDoc,
      setDoc, 
      onSnapshot, 
      updateDoc, 
      increment, 
      enableIndexedDbPersistence 
    } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "daf-cgoc.firebaseapp.com",
      projectId: "daf-cgoc",
      storageBucket: "daf-cgoc.firebasestorage.app",
      messagingSenderId: "1087927875615",
      appId: "1:1087927875615:web:575dfba12b62beef1cbd2a",
      measurementId: "G-4M7J7DZV6Y"
    };

    // Initialize Firebase
    const appFirebase = initializeApp(firebaseConfig);
    const analytics = getAnalytics(appFirebase);
    const db = getFirestore(appFirebase);

    // Enable offline persistence
    enableIndexedDbPersistence(db).catch((err) => {
      console.error("Firestore persistence error:", err);
    });

    // Define your photos (set your image IDs and URLs as needed)
    const photos = [
      { id: 'test1', imageUrl: '../images/team/1LT Bri Johndrow-DS.jpg' },
      { id: 'test2', imageUrl: '../images/team/1LT Carlos Rivera-Comm RD.jpg' },
      { id: 'test3', imageUrl: '../images/team/1LT Bri Johndrow-DS.jpg' },
      { id: 'test4', imageUrl: '../images/team/1LT Carlos Rivera-Comm RD.jpg' }
    ];

    const photoGrid = document.getElementById('photo-grid');

    // Dynamically create each photo voting item
    photos.forEach(async (photo) => {
      // Create portfolio item container
      const itemDiv = document.createElement('div');
      itemDiv.className = 'bgrid folio-item';
      
      // The .item-wrap enforces a uniform aspect ratio
      const wrapDiv = document.createElement('div');
      wrapDiv.className = 'item-wrap';

      // Create image element
      const imgElem = document.createElement('img');
      imgElem.src = photo.imageUrl;
      imgElem.alt = photo.id;
      wrapDiv.appendChild(imgElem);

      // Create container for vote button and vote count
      const voteContainer = document.createElement('div');
      voteContainer.className = 'vote-container';

      const voteBtn = document.createElement('button');
      voteBtn.className = 'vote-button';
      voteBtn.textContent = 'Vote';
      voteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        vote(photo.id);
      });

      const voteCountDiv = document.createElement('div');
      voteCountDiv.className = 'vote-count';
      voteCountDiv.id = 'vote-count-' + photo.id;
      voteCountDiv.textContent = '0';

      voteContainer.appendChild(voteBtn);
      voteContainer.appendChild(voteCountDiv);

      // Append everything
      itemDiv.appendChild(wrapDiv);
      itemDiv.appendChild(voteContainer);
      photoGrid.appendChild(itemDiv);

      // Reference the document in Firestore
      const photoDocRef = doc(db, 'photos', photo.id);
      // Check if the document exists; if not, set it with a default vote count
      const docSnap = await getDoc(photoDocRef);
      if (!docSnap.exists()) {
        setDoc(photoDocRef, { votes: 0, imageUrl: photo.imageUrl });
      }

      // Listen for real-time updates on the vote count
      onSnapshot(photoDocRef, (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.data();
          document.getElementById('vote-count-' + photo.id).textContent = data.votes || 0;
        }
      });
    });

    // Global vote function: increments vote count in Firestore
    window.vote = async function(imageId) {
      const photoDocRef = doc(db, 'photos', imageId);
      try {
        await updateDoc(photoDocRef, { votes: increment(1) });
      } catch (error) {
        console.error("Error updating vote for " + imageId + ":", error);
      }
    }
  </script>
</body>
</html>
